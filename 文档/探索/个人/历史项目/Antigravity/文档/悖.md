# 悖 (BEI / Antinomy) — 真理入口

> 把中文目标变成可运行交付物，并生成可回放证据链与可复用技能。

**当前版本**: v0.1.0 — 中文化基础设施完成

---

## 1. 当前焦点 Focus

> AI 在此写入当前正在进行的任务，防止迷路。只允许 1 条。

- [ ] 实现编排器核心逻辑

---

## 2. 全息索引 TOC

> 只沿索引前进，禁止全盘扫描。按需读取目标文件。

### 核心文档

| 文档 | 路径 | 用途 |
|------|------|------|
| 兼容性清单 | [文档/兼容性清单.yaml](文档/兼容性清单.yaml) | Unicode 预检测结论 |
| 词汇映射表 | [文档/词汇映射表.yaml](文档/词汇映射表.yaml) | ASCII → 中文映射 |
| 语言裁决账本 | [文档/语言裁决账本.md](文档/语言裁决账本.md) | 命名点裁决记录 |
| 中文化约束 | [文档/中文化约束.md](文档/中文化约束.md) | Rust 中文化边界与最佳实践 |
| 中文化审计报告 | [文档/中文化审计报告.md](文档/中文化审计报告.md) | 中文化覆盖率与审计结果 |
| 项目状况报告 | [文档/项目状况报告.md](文档/项目状况报告.md) | 项目现状、缺陷与计划 |

### Rust 包（核心代码）

| 包 | 路径 | 状态 | 描述 |
|-----|------|------|------|
| bei_core | [包/核心/](包/核心/) | ✅ | 核心类型：目标、交付物、证据、错误、检查 |
| bei_macro | [包/宏/](包/宏/) | ✅ | 中文宏封装：打印、格式化、有/无、成/败 |
| bei_orchestrator | [包/编排器/](包/编排器/) | ✅ | 任务编排器 |
| bei_replay | [包/回放/](包/回放/) | ✅ | 回放系统：事件记录与回放 |
| bei_skill | [包/技能/](包/技能/) | ✅ | 技能引擎：加载与执行 |
| bei_cli | [包/命令行/](包/命令行/) | ✅ | CLI 入口：执行、技能、回放、检查、修复 |


### 执行回放

| 目录 | 用途 |
|------|------|
| [回放/](回放/) | 执行回放记录 |
| [回放/_模板/](回放/_模板/) | 标准回放结构模板 |

### 技能库

| 目录 | 用途 |
|------|------|
| [技能/](技能/) | 可复用技能 |
| [技能/_模板/](技能/_模板/) | 标准技能结构模板 |

### 工作流

| 工作流 | 路径 | 用途 |
|--------|------|------|
| 强制工作顺序 | [.agent/workflows/强制工作顺序.md](.agent/workflows/强制工作顺序.md) | 7 步必须流程 |
| Unicode预检测 | [.agent/workflows/unicode预检测.md](.agent/workflows/unicode预检测.md) | 快速/完整两套检测 |

---

## 3. 三条最高法（硬锁）

### A) 能 Unicode 必中文
- 名称与对人输出默认中文
- 不确定先做 Unicode 预检测
- 硬性限制时保留最小机器名 + 中文映射表

### B) 先证据后行动
- 不可失败路径禁止靠主工程撞墙学习
- 关键结论必须可复现
- 证据不足就停机

### C) 全过程可回放
- 每次执行产出 `回放/<run_id>/`
- 失败也要落盘

---

## 4. 智能单文件协议（第四条最高法）

### D) 逻辑单文件 / 分形地图

**核心原则**：入口永远一处，上下文永远连续。

#### 读取策略
- 任何任务开始**必须先读本文件**
- 只沿 TOC 索引前进，按需读取 CONTEXT.md
- **禁止全盘扫描**

#### 写入策略
- 任何新文件必须**立即在本文件 TOC 登记**
- 格式：`[链接] + 一句用途`
- **禁止孤儿文件**

#### 智能分片阈值

| 文件类型 | 最佳长度 | Token 阈值 | 行数阈值 |
|----------|----------|------------|----------|
| 文档类 (.md) | 4000-6000 tokens | ~6k tokens | 400-600 行 |
| 代码类 (.rs/.ts) | 3000-5000 tokens | ~5k tokens | 300-500 行 |
| 配置类 (.yaml) | 2000-3000 tokens | ~3k tokens | 200-300 行 |

**逻辑阈值**（无论长度，满足即分裂）：
- TOC 项超过 15-20 项
- 同一文件有 3+ 个正交领域

#### 原子性分裂（必须同时完成）

分裂文件时，一次提交必须完成：
1. ✅ 新文件创建并写入内容
2. ✅ 原位置保留 `[链接] + 一句摘要 + 迁移原因`
3. ✅ 本文件 TOC 登记
4. ✅ 上级 CONTEXT.md 登记（如有）
5. ✅ 单独 commit，便于回滚

---

## 5. 珠子队列 Beads

> 任务排队。当前聚焦标 🔥，其余排队。

| # | 任务 | 状态 |
|---|------|------|
| 1 | 完成项目骨架 | ✅ 完成 |
| 2 | 全面中文化 | ✅ 完成 |
| 3 | 开发首个模块 | ⏳ 待开始 |

---

## 6. MVP 验收清单

- [x] 输入：中文目标 → 解析成功
- [ ] 输出：交付物落盘
- [ ] 验证：命令可执行 + 证据存在
- [x] 回放：`回放/<run_id>/` 结构完整
- [ ] 固化：skill 生成 + 可复跑

---

## 变更记录

| 日期 | 变更 | 作者 |
|------|------|------|
| 2026-01-31 | **v0.1.0 发布**：中文化基础设施完成，检查工具100%覆盖率 | Antigravity |
| 2026-01-30 | **target→构建**：切换 MSVC 工具链，构建目录中文化 | Antigravity |
| 2026-01-30 | **入口文件中文化**：main.rs→入口.rs、lib.rs→库.rs | Antigravity |
| 2026-01-30 | **src→源码**：所有包的 src 目录改为 源码，更新 Cargo.toml path 配置 | Antigravity |
| 2026-01-30 | **全面中文化**：目录 crates→包、docs→文档、runs→回放、skills→技能 | Antigravity |
| 2026-01-30 | 添加 bei_macro crate，实现深度中文化宏封装 | Antigravity |
| 2026-01-30 | 添加检查命令，支持 `bei 检查` 扫描代码中文化程度 | Antigravity |
| 2026-01-30 | 完成 Rust workspace 初始化，6 个 crates 编译通过 | Antigravity |
| 2026-01-29 | 创建真理入口，合并 AI_MAP.md | Antigravity |
| 2026-01-29 | 增加第四条最高法：智能单文件协议 | Antigravity |
