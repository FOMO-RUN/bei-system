---
description: 悖项目强制工作顺序，不可跳过
---

# 强制工作顺序

每次执行任务时必须严格按此顺序进行：

## 0. 读取真理入口（必须第一步）
```powershell
// turbo
Test-Path "悖.md"
```
- **必须先读 `悖.md`**（真理入口，唯一权威）
- 只沿 TOC 索引前进，**禁止全盘扫描**
- 按需读取目标 CONTEXT.md

## 1. 定位当前焦点
- 查看 `悖.md` 的"当前焦点"段落
- 确认当前任务，防止迷路

## 2. 读取模块路标
- 定位相关模块的 `modules/<模块名>/CONTEXT.md`
- 如果不存在，先创建基线 CONTEXT.md

## 3. 修改代码/写文件
- 按照 CONTEXT.md 中的接口契约编写
- 遵循"能 Unicode 必中文"原则
- 不确定时先做 Unicode 预检测（见 `unicode预检测.md`）
- **新文件必须立即在 `悖.md` TOC 登记**

## 4. 运行测试/验证命令
```powershell
# 根据模块类型运行相应验证
# Rust: cargo test
# Node: npm test / bun test
# Deno: deno test
```

## 5. 记录运行结果与证据
- 在 `runs/<run_id>/events.jsonl` 记录事件
- 将关键输出保存到 `runs/<run_id>/artifacts/`

## 6. 更新文档
- 更新 `modules/<模块名>/CONTEXT.md`（变更记录）
- 更新 `悖.md`（当前焦点/TOC/珠子队列）
- 如有命名裁决，更新 `docs/语言裁决账本.md`

## 7. 生成回放
- 完成 `runs/<run_id>/summary_zh.md`
- 确保包含：目标、交付物、验证结果、证据

---

## 智能单文件协议（硬锁）

### 读取策略
- 入口永远是 `悖.md`
- 只沿 TOC 索引前进
- 禁止全盘扫描

### 写入策略
- 新文件必须立即在 `悖.md` TOC 登记
- 格式：`[链接] + 一句用途`
- 禁止孤儿文件

### 智能分片
当文件满足以下条件时必须分裂：

| 触发 | 阈值 |
|------|------|
| Token 过载 | 文档 >6k / 代码 >5k / 配置 >3k |
| 行数过载 | 文档 >500 / 代码 >400 / 配置 >250 |
| TOC 过载 | 单文件 TOC >15 项 |
| 领域正交 | 3+ 个独立领域 |

### 原子性分裂
分裂必须一次提交完成：
1. 新文件创建
2. 原位置留链接 + 摘要 + 原因
3. `悖.md` TOC 登记
4. 单独 commit

---

## 终端输出纪律

每轮最多 12 行，只允许四段：

```
DONE：本轮完成了什么
TEST：验证命令 + 成功/失败
PATH：新增/变更的关键路径
NEXT：下一步 1-3 条
```

详细内容写入 `docs/` 或 `runs/<run_id>/`。
