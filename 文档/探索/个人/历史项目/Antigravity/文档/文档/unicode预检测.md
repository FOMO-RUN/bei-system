---
description: Unicode 预检测工作流，在引入新工具或遇到命名点时使用
---

# Unicode 预检测工作流

## 触发条件

遇到以下情况时**必须**执行本工作流：
- 新引入工具/框架/协议/构建规则
- 涉及不可失败路径的命名点（包名/特性名/CLI 参数/配置键/路径/环境变量等）
- 对是否支持 Unicode 没有证据

---

## 快速预检测（低风险、节奏快）

适用于：非关键路径、可随时修改的命名点

### 步骤

1. 执行简单测试命令
2. 记录结果到 `docs/兼容性清单.yaml`
3. 终端只输出结论和路径

### 输出格式

```yaml
- 工具: [工具名]
  版本: [版本]
  检测日期: [日期]
  检测项:
    - 命名点: [具体位置]
      支持unicode: true/false
      证据: [简短说明]
  裁决: [结论]
  证据路径: null
```

---

## 完整预检测（高风险、会返工的）

适用于：不可失败路径、发布路径、跨模块改动

### 步骤

1. 创建隔离测试目录
```powershell
// turbo
New-Item -ItemType Directory -Path "runs/unicode_test_$(Get-Date -Format 'yyyyMMdd_HHmmss')" -Force
```

2. 在隔离环境中测试

3. 记录完整信息到 `docs/兼容性清单.yaml`：
   - 环境（OS/工具版本/命令）
   - 目标命名点
   - 最小复现步骤（可复制粘贴命令）
   - 结果（成功/失败 + 关键报错片段）
   - 影响面（会影响哪些目录/命令/发布流程）
   - 裁决结论（能 Unicode 必中文/必须 ASCII）
   - 替代策略（双轨映射/别名层/封装层）
   - 回滚点（如何撤销、如何恢复）

4. 如需映射，更新 `docs/词汇映射表.yaml`

5. 更新 `docs/语言裁决账本.md`

---

## 选择规则

```
默认 → 快速预检测
     ↓
涉及不可失败路径？ → 是 → 完整预检测
     ↓
涉及发布路径？ → 是 → 完整预检测
     ↓
涉及跨模块改动？ → 是 → 完整预检测
     ↓
否 → 快速预检测
```

---

## 风险门禁

以下情况**立即停机**：
- Unicode 支持未知但已进入不可失败路径
- 证据不足且会导致返工

停机时生成：
- `runs/<run_id>/summary_zh.md`（停机原因）
- `runs/<run_id>/questions_zh.md`（问题清单和选项）
