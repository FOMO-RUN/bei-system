# 悖（BEI / Antinomy）AI 地图

> 把中文目标变成可运行交付物，并生成可回放证据链与可复用技能

---

## 1. 当前焦点 Focus

> AI 在此写入当前正在进行的任务，防止迷路。只允许 1 条。

- [x] 全面中文化目录和文件命名
- [x] 实现分形文档结构
- [ ] 完善技能库和回放功能

---

## 2. 全息索引 TOC

> 只沿索引前进，禁止全盘扫描。按需读取目标文件。

### 核心文档

| 文档 | 路径 | 用途 |
|------|------|------|
| AI地图 | [AI地图.md](AI地图.md) | 项目总规范和契约 |
| 兼容性清单 | [../docs/兼容性清单.md](../docs/兼容性清单.md) | Unicode 预检测结论 |
| 词汇映射表 | [../docs/词汇映射表.yaml](../docs/词汇映射表.yaml) | ASCII → 中文映射 |
| 语言裁决账本 | [../docs/语言裁决账本.md](../docs/语言裁决账本.md) | 命名点裁决记录 |

### Rust 包（核心代码）

| 包 | 路径 | 状态 | 描述 |
|-----|------|------|------|
| 核心 | [../包/核心/上下文.md](../包/核心/上下文.md) | ✅ | 核心类型：目标、交付物、证据、错误 |
| 宏 | [../包/宏/上下文.md](../包/宏/上下文.md) | ✅ | 中文宏封装：打印、格式化、断言 |
| 编排器 | [../包/编排器/上下文.md](../包/编排器/上下文.md) | ✅ | 任务编排器：目标解析和执行协调 |
| 回放 | [../包/回放/上下文.md](../包/回放/上下文.md) | ✅ | 回放系统：事件记录与回放 |
| 技能 | [../包/技能/上下文.md](../包/技能/上下文.md) | ✅ | 技能引擎：加载与执行 |
| 命令行 | [../包/命令行/上下文.md](../包/命令行/上下文.md) | ✅ | CLI 入口：执行、技能、回放、检查 |

### 执行记录

| 目录 | 用途 |
|------|------|
| [../构建/](../构建/) | 构建输出目录（中文化） |

### 参考实现

| 目录 | 用途 |
|------|------|
| [../对比/](../对比/) | 参考实现和学习资料 |

---

## 3. 项目概述

把中文目标变成可运行交付物，并生成可回放证据链与可复用技能，在 Windows 优先、Rust 主体的前提下推进一个中文主权的代理编排层。

## 4. 模块索引

- **核心编排层** ([包/编排器/](../包/编排器/)) - 主要执行引擎
- **中文处理模块** ([包/核心/](../包/核心/)中的中文类型) - Unicode 支持与中文命名
- **证据链模块** ([包/回放/](../包/回放/)) - 回放与验证机制
- **技能库模块** ([包/技能/](../包/技能/)) - 技能抽象与复用
- **兼容性检测** ([包/核心/](../包/核心/)中的错误处理) - Unicode 预检测

---

## 5. 三条最高法（硬锁）

### A) 能 Unicode 必中文
- 名称与对人输出默认中文
- 不确定先做 Unicode 预检测
- 硬性限制时保留最小机器名 + 中文映射表

### B) 先证据后行动
- 不可失败路径禁止靠主工程撞墙学习
- 关键结论必须可复现
- 证据不足就停机

### C) 全过程可回放
- 每次执行产出 `回放/<run_id>/`
- 失败也要落盘

---

## 6. 智能单文件协议（第四条最高法）

### D) 逻辑单文件 / 分形地图

**核心原则**：入口永远一处，上下文永远连续。

#### 读取策略
- 任何任务开始**必须先读本文件**
- 只沿 TOC 索引前进，按需读取 上下文.md
- **禁止全盘扫描**

#### 写入策略
- 任何新文件必须**立即在本文件 TOC 登记**
- 格式：`[链接] + 一句用途`
- **禁止孤儿文件**

#### 智能分片阈值

| 文件类型 | 最佳长度 | Token 阈值 | 行数阈值 |
|----------|----------|------------|----------|
| 文档类 (.md) | 4000-6000 tokens | ~6k tokens | 400-600 行 |
| 代码类 (.rs) | 3000-5000 tokens | ~5k tokens | 300-500 行 |
| 配置类 (.yaml) | 2000-3000 tokens | ~3k tokens | 200-300 行 |

**逻辑阈值**（无论长度，满足即分裂）：
- TOC 项超过 15-20 项
- 同一文件有 3+ 个正交领域

#### 原子性分裂（必须同时完成）

分裂文件时，一次提交必须完成：
1. ✅ 新文件创建并写入内容
2. ✅ 原位置保留 `[链接] + 一句摘要 + 迁移原因`
3. ✅ 本文件 TOC 登记
4. ✅ 上级 上下文.md 登记（如有）
5. ✅ 单独 commit，便于回滚

---

## 7. 总契约

1. 所有公共接口必须支持中文命名
2. 每次执行必须生成可回放记录
3. 关键决策必须有证据支撑
4. 成功闭环必须抽象为技能

---

## 8. 验收标准

- [x] MVP 端到端闭环
- [x] 中文命名全链路支持
- [x] 完整回放机制
- [x] 至少 3 个基础技能

---

## 9. 风险与约束

- Windows 环境下的 Unicode 兼容性
- Rust 生态工具链的中文支持
- 性能与规范化的平衡

---

## 10. 版本历史

- v0.1.0 - 项目初始化，建立骨架
- v0.1.1 - 全面中文化重构，完成workspace结构
- v0.1.2 - MVP功能实现，CLI工具和技能系统
- v0.1.3 - 实现分形文档结构，完善模块上下文
