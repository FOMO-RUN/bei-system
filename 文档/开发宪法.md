# 开发宪法

版本：0.0.1  
适用范围：本项目内部  
读者：执行任务的大模型与维护者  
定位：优先服务大模型阅读，短句优先，歧义最小化  

## 目录

1. [1. 目标与范围](#1-目标与范围)
2. [2. 术语与缩写](#2-术语与缩写)
3. [3. 总原则](#3-总原则)
4. [3.1 五级法则索引](#31-五级法则索引)
5. [3.2 道法术器架构](#32-道法术器架构)
6. [4. 当前焦点](#4-当前焦点)
7. [5. 索引与单文件协议](#5-索引与单文件协议)
8. [6. 中文边界](#6-中文边界)
9. [7. 最小闭环流程](#7-最小闭环流程)
10. [8. 证据与回放最小要求](#8-证据与回放最小要求)
11. [9. 文档与命名规则](#9-文档与命名规则)
12. [10. 珠子队列](#10-珠子队列)
13. [11. 验收清单](#11-验收清单)
14. [12. 例外处理](#12-例外处理)
15. [13. 变更管理](#13-变更管理)

## 1. 目标与范围

🧭 定位：本宪法用于约束自动化开发的行为与证据标准，确保大模型可智能感知、可精准执行、可复盘、可自动维护  
🏗️ 系统定位：代理编排层 / 常驻守护进程  
🎯 目标：把中文目标变成可运行交付物，并保留可回放证据链与可复用技能  
🧱 范围：需求、设计、实现、验证、复盘  
🦀 语言：仅使用 Rust（锈语言）  
⚖️ 取舍：先闭环，后扩展  

## 2. 术语与缩写

- 🤖 大模型：执行任务的模型能力
- 🧪 最小可行流程（MVP）：最小闭环与最小验收
- 📚 目录索引（TOC）：唯一入口与文件索引
- 🛠️ 命令行（CLI）：命令行交互与执行入口
- 🧬 统一码（Unicode）：通用字符编码体系
- 🧵 编号（ID）：用于回放与证据链标识
- 🧾 对象标记（TOON）：极简结构化输出格式
- 🛡️ 守护进程：常驻后台的执行进程
- 🧩 代理编排层：任务协调与工具调度层
- 🧊 提示词缓存：复用固定前缀降低成本与延迟

## 3. 总原则

🧱 A) 能统一码必中文  
- 名称与对人输出默认中文  
- 不确定先做预检测  
- 硬性限制时保留最小机器名 + 中文映射  

🧾 B) 先证据后行动  
- 不可失败路径禁止靠主工程撞墙学习  
- 关键结论必须可复现  
- 证据不足就停机  

🔁 C) 全过程可回放  
- 每次执行产出回放记录  
- 失败也要落盘  

🗺️ D) 逻辑单文件 / 分形地图  
- 入口永远一处，上下文永远连续  

### 3.1 五级法则索引

#### 🌟 物理法则（不可违背）

- 上下文优先级：先读入口与上下文，再动手  
- 强制读图：先读大模型地图，再写代码  
- 文档自维护：代码变更必须同步文档  
- 边界声明：先说明要做与不做的范围  
- 边界裁决：不可失败边界先锁定，执行阶段不试错  
- 结构化契约：输出必须可验证、可回放  
- 失败升级：失败必须落盘并复盘  
- 禁止事项：禁止全盘扫描与无证据推进  

#### 🧠 思维法则（直觉培养）

- 第一性原理：回到问题本质  
- 奥卡姆剃刀：选择最小可行方案  
- 五步工作法：目标→约束→闭环→证据→复盘  
- 循环改进（PDCA）：计划→执行→检查→改进  
- 直觉训练：用少量例子校准判断  
- 校准机制：用验收口径约束结论  
- 直觉蒸馏：系统二→系统一，沉淀定式  
- 反例纠偏：错误直觉必须入库修正  
- 对称审美：中文命名追求对称与简洁  

#### ⚡ 数学法则（逻辑必然）

- 不重复（DRY）：避免同义重复与重复实现  
- 保持简单（KISS）：能简单就不复杂  
- 递归自指：规则必须可递归应用  
- 概率思维：用证据强度衡量结论  
- 消除浪费：去除无产出的步骤  
- 帕累托法则：优先解决关键 20%  
- 持续改进：每次复盘都应增益  

#### 🎯 工程法则（最佳实践）

- 职责分离（SOLID）：结构清晰、职责明确  
- 不做无用（YAGNI）：未用功能不实现  
- 持续集成与交付（CI/CD）：自动化验证与交付  
- 测试先行（TDD）：先定义验收，再实现  
- 依赖管理：版本可控、来源可信  
- 评估驱动（Evals）：关键能力必须可评估  
- 工作流标准：流程统一、可复用  
- 任务路由：按模块与能力分派  
- 工具协议：工具调用有明确输入输出  
- 钩子与技能：守门钩子强制执行  
- 开发环境集成（IDE）：提升执行一致性  

#### 🌈 文化法则（体验增强）

- 统一码中文：能中文就中文  
- 表情规范：少量表情用于分段提示  
- 术语映射：术语一致，避免多义  
- 写作风格：短句、低歧义、可检验  

### 3.2 道法术器架构

- 道：价值与方向（长期价值优于短期便利）  
- 法：约束与标准（可验证、可回放、可追溯）  
- 术：方法与流程（最小闭环、证据链）  
- 器：工具与实现（命令行、脚本、钩子）  


## 4. 当前焦点

🔥 只允许 1 条  
- [ ] 由维护者填写当前聚焦  

阶段路线（参考）：脊柱（守护进程）→手脚（技能与工具）→大脑（多代理协作）  

## 5. 索引与单文件协议

逻辑单文件，物理可分片。  

### 🤖 大模型地图自动化感知系统

1. **先读地图，再写代码**：任何代码修改前，必须先读取相关上下文  
2. **自动文档维护**：修改代码后必须同步更新文档  
3. **精准上下文加载**：避免无关信息干扰注意力  

### 🗺️ 大模型地图双层结构

- **全局地图**：`大模型地图.md` — 项目宪法与核心索引  
- **模块上下文**：各模块目录下的 `上下文.md` — 详细约束与规范  

### ⚡ 执行流程

```
接收任务 → 读取大模型地图 → 读取目标模块上下文 → 执行代码 → 更新文档 → 运行同步脚本
```

### 🛡️ 自动化守门员（钩子）

```bash
# 提交前检查：代码修改必须同步更新上下文
# 强制执行：防止大模型或人类忘记文档维护
```

🧭 读取策略  
- 任务开始必须先读入口文件  
- 只沿目录索引前进，按需读取目标文件  
- 禁止全盘扫描  

🧩 写入策略  
- 新文件必须立即登记在索引  
- 格式：链接 + 一句用途  
- 禁止孤儿文件  

🧠 规则加载策略（节约上下文）  
- 规则按需加载，不常用规则放附录或探索  
- 入口规则尽量短，详细内容用索引引用  

⚖️ 规范投入取舍原则  
- 一般场景：分形文档足够  
- 高风险/高精度任务：才引入更严格规范  

🪶 省令牌策略（提示词与输出）  
- 静态规则前置、动态信息后置  
- 结构化分段（标题或标签）  
- 只保留必要上下文，去冗余  
- 明确输出长度与字段  
- 输出优先 TOON，空字段不输出  

🧮 智能分片阈值  

| 文件类型 | 令牌阈值 | 行数阈值 |
|---|---|---|
| 文档类 | 约 6000 | 400-600 |
| 代码类 | 约 5000 | 300-500 |
| 配置类 | 约 3000 | 200-300 |

📌 逻辑阈值（满足即分裂）  
- 索引项超过 15-20 条  
- 同一文件出现 3 个以上正交领域  

🧱 原子性分裂（必须同时完成）  
1. 新文件创建并写入内容  
2. 原位置保留链接 + 一句摘要 + 迁移原因  
3. 索引登记  
4. 上级索引登记（如有）  
5. 单独提交，便于回滚  

## 6. 中文边界

🟢 绿：可稳定中文化（目录名、文件名、对外输出、错误信息、文档内容、类型与函数命名）  
🟡 黄：可中文但需约束（配置值、数据键名、跨平台命名、工具兼容）  
🔴 红：不可中文或代价过高（语言关键字、构建配置键、依赖名称、命令行基础语法）  

中文命名规则（强制）  
- 语义完整，不省略核心名词  
- 动词优先，动词在前  
- 禁止中英拼接  
- 中文与中文保持对称  
- 术语统一，避免多义  

## 7. 最小闭环流程

1. 📝 写清目标与验收  
2. 📏 明确约束与边界（含红区/绿区裁决）  
3. 🔧 实现最小闭环  
4. 🧾 生成交付物与回放证据  
5. ✅ 复盘并固化为技能  

### 7.1 强制工作顺序（不可跳过）

0. 读取入口：先读 `大模型地图.md` 与当前焦点  
1. 定位任务：确认当前聚焦与目标模块  
2. 读取上下文：先读模块上下文再动手  
3. 修改实现：遵循中文边界与约束，出现新命名点先做统一码预检测  
4. 运行验证：执行测试或验证命令  
5. 记录证据：保存关键输入、输出与日志  
6. 更新文档：同步上下文与索引  
7. 生成回放：完成回放摘要与证据归档  

角色分工：裁决者锁边界，执行者只在安全区实现，验证者只看证据。  

### 7.2 终端输出纪律

每轮最多 12 行，只允许四段：

```
完成：本轮完成了什么
验证：验证命令 + 成功/失败
路径：新增/变更的关键路径
下一步：下一步 1-3 条
```

补充约束：
- 验证必须写命令与结果  
- 路径必须包含具体路径  
- 输出优先 TOON，省略空字段  

## 8. 证据与回放最小要求

- 🧾 目标文本  
- 🧩 关键输入  
- 📦 关键输出  
- 🧪 执行步骤  
- 🕒 时间与环境  
- 🧵 运行编号（ID）  
- ❓ 成功或失败原因  

## 9. 文档与命名规则

- 🗂️ 新文件必须登记在目录或索引  
- 🚫 禁止孤儿文件  
- 🧾 修改代码后必须同步更新文档  
- 🧭 命名裁决必须记录在裁决账本  
- 🛡️ 命名守卫：命名点先裁决红区/绿区  
- 🧵 双轨保障：机器名（ASCII）+ 中文显示名  
- ✅ 中文合规检查：绿区必须中文，红区必须双轨  
- 🧠 直觉定式库与反例库必须维护  
- 🧾 术语映射变更必须同步更新  
- 📝 变更必须写明原因与影响  
- 🔎 重要结论必须可追溯  

## 10. 珠子队列

🧵 任务排队，当前聚焦用 🔥 标记，其余排队  
推进规则：队列非空则持续推进；有钩子或触发则立即推进。  
持久化：任务与状态以结构化文本 + 版本记录保存。  

| # | 任务 | 状态 |
|---|---|---|
| 1 | 待写 | ⏳ |

## 11. 验收清单

- [ ] ✅ 输入：中文目标解析  
- [ ] ✅ 输出：交付物落盘  
- [ ] ✅ 验证：命令可执行 + 证据存在  
- [ ] ✅ 回放：回放结构完整  
- [ ] ✅ 固化：技能生成 + 可复跑  

## 12. 例外处理

- ⚠️ 只允许为安全、兼容或时间紧急而破例  
- 🧾 破例必须记录原因与影响  
- 🧩 破例结束后必须补齐证据  

## 13. 变更管理

- 🧰 宪法变更必须可执行、可检查  
- 📝 每次变更必须记录版本与变更点  
- 📣 变更完成后必须同步给执行大模型  
- 🧭 系统级提示词与宪法级文档纳入同级变更管理  

